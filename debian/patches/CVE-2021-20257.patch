From: Markus Koschany <apo@debian.org>
Date: Sat, 27 Mar 2021 10:57:14 +0200
Subject: CVE-2021-20257

Bug-Debian: https://bugs.debian.org/984450
Origin: https://git.qemu.org/?p=qemu.git;a=commit;h=3de46e6fc489c52c9431a8a832ad8170a7569bd8
---
 hw/net/e1000.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/hw/net/e1000.c b/hw/net/e1000.c
index 9d76c52..e961651 100644
--- a/hw/net/e1000.c
+++ b/hw/net/e1000.c
@@ -692,6 +692,9 @@ process_tx_desc(E1000State *s, struct e1000_tx_desc *dp)
         msh = tp->hdr_len + tp->mss;
         do {
             bytes = split_size;
+            if (tp->size >= msh) {
+                goto eop;
+            }
             if (tp->size + bytes > msh)
                 bytes = msh - tp->size;
 
@@ -719,6 +722,7 @@ process_tx_desc(E1000State *s, struct e1000_tx_desc *dp)
         tp->size += split_size;
     }
 
+eop:
     if (!(txd_lower & E1000_TXD_CMD_EOP))
         return;
     if (!(tp->tse && tp->cptse && tp->size < tp->hdr_len)) {
