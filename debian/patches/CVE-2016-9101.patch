From 2634ab7fe29b3f75d0865b719caf8f310d634aae Mon Sep 17 00:00:00 2001
From: Li Qiang <liqiang6-s@360.cn>
Date: Sat, 8 Oct 2016 05:07:25 -0700
Subject: [PATCH] net: eepro100: fix memory leak in device uninit

The exit dispatch of eepro100 network card device doesn't free
the 's->vmstate' field which was allocated in device realize thus
leading a host memory leak. This patch avoid this.

Signed-off-by: Li Qiang <liqiang6-s@360.cn>
Signed-off-by: Jason Wang <jasowang@redhat.com>

Origin: ubuntu, https://launchpad.net/ubuntu/+source/qemu/2.0.0+dfsg-2ubuntu1.43
Bug-Debian: https://bugs.debian.org/842455
Reviewed-by: Santiago R.R. <santiagorr@riseup.net>
---
 hw/net/eepro100.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

Index: qemu-2.0.0+dfsg/hw/net/eepro100.c
===================================================================
--- qemu-2.0.0+dfsg.orig/hw/net/eepro100.c	2016-11-07 15:46:00.460019417 -0500
+++ qemu-2.0.0+dfsg/hw/net/eepro100.c	2016-11-07 15:46:00.460019417 -0500
@@ -1864,6 +1864,7 @@
     memory_region_destroy(&s->io_bar);
     memory_region_destroy(&s->flash_bar);
     vmstate_unregister(&pci_dev->qdev, s->vmstate, s);
+    g_free(s->vmstate);
     eeprom93xx_free(&pci_dev->qdev, s->eeprom);
     qemu_del_nic(s->nic);
 }
