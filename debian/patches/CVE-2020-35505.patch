Description: CVE-2020-35505
Author: Abhijith PA <abhijith@debian.org>
---

--- qemu-3.1+dfsg.orig/hw/scsi/esp.c
+++ qemu-3.1+dfsg/hw/scsi/esp.c
@@ -135,6 +135,11 @@ static void do_busid_cmd(ESPState *s, ui
 
     trace_esp_do_busid_cmd(busid);
     lun = busid & 7;
+
+     if (!s->current_dev) {
+        return;
+    }
+
     current_lun = scsi_device_find(&s->bus, 0, s->current_dev->id, lun);
     s->current_req = scsi_req_new(current_lun, 0, lun, buf, s);
     datalen = scsi_req_enqueue(s->current_req);
