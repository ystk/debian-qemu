From: Prasad J Pandit <address@hidden>

When receiving packets over MIPSnet network device, it uses
 receive buffer of size 1514 bytes. In case the controller
accepts large(MTU) packets, it could lead to memory corruption.
Add check to avoid it.

Reported by: Oleksandr Bazhaniuk <address@hidden>

Signed-off-by: Prasad J Pandit <address@hidden>

Origin: ubuntu, https://launchpad.net/ubuntu/+source/qemu/2.0.0+dfsg-2ubuntu1.43
Bug-Debian: https://bugs.debian.org/821061
Reviewed-by: Santiago R.R. <santiagorr@riseup.net>
---
 hw/net/mipsnet.c | 3 +++
 1 file changed, 3 insertions(+)

Index: qemu-2.3+dfsg/hw/net/mipsnet.c
===================================================================
--- qemu-2.3+dfsg.orig/hw/net/mipsnet.c	2016-05-10 14:22:36.426224845 -0400
+++ qemu-2.3+dfsg/hw/net/mipsnet.c	2016-05-10 14:22:36.386224342 -0400
@@ -82,6 +82,9 @@
     if (!mipsnet_can_receive(nc))
         return -1;
 
+    if (size >= sizeof(s->rx_buffer)) {
+        return 0;
+    }
     s->busy = 1;
 
     /* Just accept everything. */
