From: Markus Koschany <apo@debian.org>
Date: Wed, 25 Aug 2021 22:23:45 +0200
Subject: CVE-2021-3682

Bug-Debian: https://bugs.debian.org/991911
Origin: https://gitlab.com/qemu-project/qemu/-/commit/5e796671e6b8d5de4b0b423dce1b3eba144a92c9
---
 hw/usb/redirect.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/hw/usb/redirect.c b/hw/usb/redirect.c
index 73b7e2e..6b57a16 100644
--- a/hw/usb/redirect.c
+++ b/hw/usb/redirect.c
@@ -450,7 +450,7 @@ static void bufp_alloc(USBRedirDevice *dev, uint8_t *data, uint16_t len,
     if (dev->endpoint[EP2I(ep)].bufpq_dropping_packets) {
         if (dev->endpoint[EP2I(ep)].bufpq_size >
                 dev->endpoint[EP2I(ep)].bufpq_target_size) {
-            free(data);
+            free(free_on_destroy);
             return;
         }
         dev->endpoint[EP2I(ep)].bufpq_dropping_packets = 0;
