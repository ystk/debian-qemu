From fdda170e50b8af062cf5741e12c4fb5e57a2eacf Mon Sep 17 00:00:00 2001
From: Li Qiang <liqiang6-s@360.cn>
Date: Thu, 11 Aug 2016 00:42:20 +0530
Subject: [PATCH] net: vmxnet: initialise local tx descriptor

In Vmxnet3 device emulator while processing transmit(tx) queue,
when it reaches end of packet, it calls vmxnet3_complete_packet.
In that local 'txcq_descr' object is not initialised, which could
leak host memory bytes a guest.

Reported-by: Li Qiang <liqiang6-s@360.cn>
Signed-off-by: Prasad J Pandit <pjp@fedoraproject.org>
Reviewed-by: Dmitry Fleytman <dmitry@daynix.com>
Signed-off-by: Jason Wang <jasowang@redhat.com>

Origin: ubuntu, https://launchpad.net/ubuntu/+source/qemu/2.0.0+dfsg-2ubuntu1.43
Bug-Debian: https://bugs.debian.org/834944
Reviewed-by: Santiago R.R. <santiagorr@riseup.net>
---
 hw/net/vmxnet3.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

Index: qemu-2.0.0+dfsg/hw/net/vmxnet3.c
===================================================================
--- qemu-2.0.0+dfsg.orig/hw/net/vmxnet3.c	2016-11-07 15:31:48.826477853 -0500
+++ qemu-2.0.0+dfsg/hw/net/vmxnet3.c	2016-11-07 15:31:48.822477808 -0500
@@ -498,6 +498,7 @@
 
     VMXNET3_RING_DUMP(VMW_RIPRN, "TXC", qidx, &s->txq_descr[qidx].comp_ring);
 
+    memset(&txcq_descr, 0, sizeof(txcq_descr));
     txcq_descr.txdIdx = tx_ridx;
     txcq_descr.gen = vmxnet3_ring_curr_gen(&s->txq_descr[qidx].comp_ring);
 
