Origin: debian, 1.1.2+dfsg-6+deb7u23
Reviewed-by: Santiago R.R. <santiagorr@riseup.net>
Bug-Debian: 862280

From: Gerd Hoffmann <kraxel@redhat.com>
Date: Fri, 28 Apr 2017 09:56:12 +0200
Subject: CVE-2017-8309: audio: release capture buffers

AUD_add_capture() allocates two buffers which are never released.
Add the missing calls to AUD_del_capture().

Impact: Allows vnc clients to exhaust host memory by repeatedly
starting and stopping audio capture.

Upstream-Commit: 3268a845f41253fb55852a8429c32b50f36f349a
---
 audio/audio.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/audio/audio.c b/audio/audio.c
index 583ee51..cf9c80d 100644
--- a/audio/audio.c
+++ b/audio/audio.c
@@ -2052,6 +2052,8 @@ void AUD_del_capture (CaptureVoiceOut *cap, void *cb_opaque)
                     sw = sw1;
                 }
                 QLIST_REMOVE (cap, entries);
+                g_free (cap->hw.mix_buf);
+                g_free (cap->buf);
                 g_free (cap);
             }
             return;
