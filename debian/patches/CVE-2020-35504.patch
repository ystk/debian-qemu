Description: CVE-2020-35504
Author: Abhijith PA <abhijith@debian.org>
---

--- a/hw/scsi/esp.c
+++ b/hw/scsi/esp.c
@@ -256,6 +256,9 @@ static void esp_do_dma(ESPState *s)
         do_cmd(s, s->cmdbuf);
         return;
     }
+    if (!s->current_req) {
+        return;
+    }
     if (s->async_len == 0) {
         /* Defer until data is available.  */
         return;
@@ -268,6 +271,11 @@ static void esp_do_dma(ESPState *s)
     } else {
         s->dma_memory_write(s->dma_opaque, s->async_buf, len);
     }
+
+    if (!s->current_req) {
+        return;
+    }
+
     s->dma_left -= len;
     s->async_buf += len;
     s->async_len -= len;
