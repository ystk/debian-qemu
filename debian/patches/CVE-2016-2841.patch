From 415ab35a441eca767d033a2702223e785b9d5190 Mon Sep 17 00:00:00 2001
From: Prasad J Pandit <pjp@fedoraproject.org>
Date: Wed, 24 Feb 2016 11:41:33 +0530
Subject: [PATCH] net: ne2000: check ring buffer control registers

Ne2000 NIC uses ring buffer of NE2000_MEM_SIZE(49152)
bytes to process network packets. Registers PSTART & PSTOP
define ring buffer size & location. Setting these registers
to invalid values could lead to infinite loop or OOB r/w
access issues. Add check to avoid it.

Reported-by: Yang Hongke <yanghongke@huawei.com>
Tested-by: Yang Hongke <yanghongke@huawei.com>
Signed-off-by: Prasad J Pandit <pjp@fedoraproject.org>
Signed-off-by: Jason Wang <jasowang@redhat.com>

Origin: ubuntu, https://launchpad.net/ubuntu/+source/qemu/2.0.0+dfsg-2ubuntu1.43
Bug-Debian: https://bugs.debian.org/817181
Reviewed-by: Santiago R.R. <santiagorr@riseup.net>
---
 hw/net/ne2000.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

Index: qemu-2.5+dfsg/hw/net/ne2000.c
===================================================================
--- qemu-2.5+dfsg.orig/hw/net/ne2000.c	2016-05-10 12:54:04.004399892 -0400
+++ qemu-2.5+dfsg/hw/net/ne2000.c	2016-05-10 12:54:04.000399857 -0400
@@ -154,6 +154,10 @@
 {
     int avail, index, boundary;
 
+    if (s->stop <= s->start) {
+        return 1;
+    }
+
     index = s->curpag << 8;
     boundary = s->boundary << 8;
     if (index < boundary)
