Origin: ubuntu, https://launchpad.net/ubuntu/+source/qemu/2.0.0+dfsg-2ubuntu1.33
Reviewed-by: Santiago R.R. <santiagorr@riseup.net>
Bug-Debian: 852232

Backport of:

From eb7a20a3616085d46aa6b4b4224e15587ec67e6e Mon Sep 17 00:00:00 2001
From: Li Qiang <liqiang6-s@360.cn>
Date: Mon, 28 Nov 2016 17:49:04 -0800
Subject: [PATCH] watchdog: 6300esb: add exit function

When the Intel 6300ESB watchdog is hot unplug. The timer allocated
in realize isn't freed thus leaking memory leak. This patch avoid
this through adding the exit function.

Signed-off-by: Li Qiang <liqiang6-s@360.cn>
Message-Id: <583cde9c.3223ed0a.7f0c2.886e@mx.google.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
---
 hw/watchdog/wdt_i6300esb.c | 9 +++++++++
 1 file changed, 9 insertions(+)

Index: qemu-2.0.0+dfsg/hw/watchdog/wdt_i6300esb.c
===================================================================
--- qemu-2.0.0+dfsg.orig/hw/watchdog/wdt_i6300esb.c	2017-04-06 09:50:33.025128615 -0400
+++ qemu-2.0.0+dfsg/hw/watchdog/wdt_i6300esb.c	2017-04-06 09:52:51.550860890 -0400
@@ -430,6 +430,8 @@
     I6300State *d = DO_UPCAST(I6300State, dev, dev);
 
     memory_region_destroy(&d->io_mem);
+    timer_del(d->timer);
+    timer_free(d->timer);
 }
 
 static WatchdogTimerModel model = {
